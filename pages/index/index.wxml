<view class="container">
  <view class="summary">
    <view class="income">
      <text>æ”¶å…¥</text>
      <text class="amount">Â¥{{totalIncome}}</text>
    </view>
    <view class="expense">
      <text>æ”¯å‡º</text>
      <text class="amount">Â¥{{totalExpense}}</text>
    </view>
  </view>

  <!-- ç­›é€‰çŠ¶æ€æ˜¾ç¤º -->
  <view class="filter-status" bindtap="showFilterPanel">
    <text wx:if="{{activeFilter === 'all'}}">å…¨éƒ¨è´¦å•</text>
    <text wx:elif="{{activeFilter === 'year'}}">{{filterYear}}å¹´</text>
    <text wx:elif="{{activeFilter === 'month'}}">{{filterYear}}å¹´{{filterMonth}}æœˆ</text>
    <view class="filter-icon">ğŸ“…</view>
  </view>

  <view class="record-list" wx:if="{{records.length > 0}}">
    <block wx:for="{{records}}" wx:key="index">
      <!-- æ—¥æœŸåˆ†ç»„æ ‡é¢˜ -->
      <view class="date-header" wx:if="{{index === 0 || records[index-1].date !== item.date}}">
        <text class="date">{{item.formattedDate}}</text>
      </view>
      
      <view class="record-item {{item.type}}" bindtap="showRecordDetail" data-record="{{item}}">
        <view class="left">
          <view class="category-container">
            <view class="icon">{{categoryIcons[item.type][item.category] ? categoryIcons[item.type][item.category] : categoryIcons[item.type]['å…¶ä»–']}}</view>
            <text class="category">{{item.category}}</text>
          </view>
          <text class="time">{{item.date}}</text>
        </view>
        <view class="right">
          <text class="amount">{{item.type === 'income' ? '+' : '-'}}Â¥{{item.amount}}</text>
          <text class="delete" catchtap="deleteRecord" data-index="{{index}}">åˆ é™¤</text>
        </view>
      </view>
    </block>
  </view>
  
  <view class="empty-state" wx:if="{{records.length === 0}}">
    <view class="empty-icon">ğŸ“‹</view>
    <text class="empty-text">{{activeFilter === 'all' ? 'æš‚æ— è®°å½•' : 'ç­›é€‰æ¡ä»¶ä¸‹æš‚æ— è®°å½•'}}</text>
    <text class="empty-subtext" wx:if="{{activeFilter === 'all'}}">ç‚¹å‡»åº•éƒ¨"+"æ·»åŠ ä¸€ç¬”æ–°è´¦å•</text>
    <text class="empty-subtext" wx:else bindtap="clearFilter">ç‚¹å‡»æ­¤å¤„æ¸…é™¤ç­›é€‰æ¡ä»¶</text>
  </view>

  <!-- ç­›é€‰é¢æ¿ -->
  <view class="filter-panel-container" wx:if="{{showFilter}}">
    <view class="filter-panel-mask" bindtap="hideFilterPanel"></view>
    <view class="filter-panel">
      <view class="filter-panel-header">
        <text>ç­›é€‰è´¦å•</text>
        <text class="close" bindtap="hideFilterPanel">Ã—</text>
      </view>
      
      <view class="filter-section">
        <view class="filter-section-title">æŒ‰å¹´ä»½ç­›é€‰</view>
        <view class="filter-options">
          <view class="filter-option {{activeFilter === 'all' ? 'active' : ''}}" bindtap="clearFilter">å…¨éƒ¨</view>
          <view wx:for="{{years}}" wx:key="*this" 
                class="filter-option {{filterYear === item && activeFilter !== 'month' ? 'active' : ''}}" 
                bindtap="selectYear" 
                data-year="{{item}}">
            {{item}}å¹´
          </view>
        </view>
      </view>
      
      <view class="filter-section" wx:if="{{filterYear}}">
        <view class="filter-section-title">æŒ‰æœˆä»½ç­›é€‰</view>
        <view class="filter-options">
          <view class="filter-option {{activeFilter === 'year' ? 'active' : ''}}" 
                bindtap="selectYear" 
                data-year="{{filterYear}}">
            å…¨å¹´
          </view>
          <view wx:for="{{months}}" wx:key="*this" 
                class="filter-option {{filterMonth === item && activeFilter === 'month' ? 'active' : ''}}" 
                bindtap="selectMonth" 
                data-month="{{item}}">
            {{item}}æœˆ
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- è´¦å•è¯¦æƒ…å¼¹çª— -->
  <view class="record-detail-modal" wx:if="{{showRecordDetail}}">
    <view class="record-detail-mask" bindtap="hideRecordDetail"></view>
    <view class="record-detail-content">
      <view class="record-detail-header">
        <text>è´¦å•è¯¦æƒ…</text>
        <text class="close" bindtap="hideRecordDetail">Ã—</text>
      </view>
      <view class="record-detail-body">
        <view class="detail-item">
          <text class="label">ç±»å‹</text>
          <text class="value">{{currentRecord.type === 'expense' ? 'æ”¯å‡º' : 'æ”¶å…¥'}}</text>
        </view>
        <view class="detail-item">
          <text class="label">é‡‘é¢</text>
          <text class="value {{currentRecord.type === 'expense' ? 'expense' : 'income'}}">
            {{currentRecord.type === 'expense' ? '-' : '+'}}Â¥{{currentRecord.amount}}
          </text>
        </view>
        <view class="detail-item">
          <text class="label">åˆ†ç±»</text>
          <view class="value category">
            <text class="icon">{{currentRecord.categoryIcon}}</text>
            <text>{{currentRecord.category}}</text>
          </view>
        </view>
        <view class="detail-item">
          <text class="label">æ—¥æœŸ</text>
          <text class="value">{{currentRecord.date}}</text>
        </view>
        <view class="detail-item" wx:if="{{currentRecord.remark}}">
          <text class="label">å¤‡æ³¨</text>
          <text class="value remark">{{currentRecord.remark}}</text>
        </view>
        <view class="detail-item" wx:else>
          <text class="label">å¤‡æ³¨</text>
          <text class="value remark empty">æš‚æ— å¤‡æ³¨</text>
        </view>
      </view>
    </view>
  </view>
</view> 