<view class="container">
  <view class="type-selector">
    <view class="type-option {{activeType === 'expense' ? 'active' : ''}}" bindtap="switchToExpense">
      <text>æ”¯å‡ºç»Ÿè®¡</text>
    </view>
    <view class="type-option {{activeType === 'income' ? 'active' : ''}}" bindtap="switchToIncome">
      <text>æ”¶å…¥ç»Ÿè®¡</text>
    </view>
  </view>

  <!-- æ—¶é—´ç­›é€‰å™¨ -->
  <view class="filter-bar">
    <view class="current-filter" bindtap="showFilterPanel">
      <text wx:if="{{activeFilter === 'all'}}">å…¨éƒ¨æ—¶é—´</text>
      <text wx:elif="{{activeFilter === 'year'}}">{{filterYear}}å¹´</text>
      <text wx:elif="{{activeFilter === 'month'}}">{{filterYear}}å¹´{{filterMonth}}æœˆ</text>
      <view class="filter-icon">â–¼</view>
    </view>
  </view>

  <!-- ç­›é€‰é¢æ¿ -->
  <view class="filter-panel" wx:if="{{showFilter}}">
    <view class="filter-header">
      <text>é€‰æ‹©æ—¶é—´èŒƒå›´</text>
      <view class="filter-close" bindtap="hideFilterPanel">Ã—</view>
    </view>
    <view class="filter-content">
      <view class="filter-option" bindtap="clearFilter">
        <text>å…¨éƒ¨æ—¶é—´</text>
        <view class="option-check" wx:if="{{activeFilter === 'all'}}">âœ“</view>
      </view>
      <view class="filter-section">
        <view class="section-title">æŒ‰å¹´ä»½</view>
        <view class="filter-years">
          <view class="year-option {{filterYear === year && activeFilter === 'year' ? 'active' : ''}}" 
                wx:for="{{years}}" 
                wx:for-item="year" 
                wx:key="*this" 
                data-year="{{year}}" 
                bindtap="selectYear">
            {{year}}
          </view>
        </view>
      </view>
      <view class="filter-section" wx:if="{{filterYear}}">
        <view class="section-title">æŒ‰æœˆä»½</view>
        <view class="filter-months">
          <view class="month-option {{filterMonth === month && activeFilter === 'month' ? 'active' : ''}}" 
                wx:for="{{months}}" 
                wx:for-item="month" 
                wx:key="*this" 
                data-month="{{month}}" 
                bindtap="selectMonth">
            {{month}}æœˆ
          </view>
        </view>
      </view>
    </view>
  </view>

  <view class="summary">
    <view class="total">
      <text>{{activeType === 'expense' ? 'æ€»æ”¯å‡º' : 'æ€»æ”¶å…¥'}}</text>
      <text class="amount">Â¥{{activeType === 'expense' ? totalExpense : totalIncome}}</text>
    </view>
  </view>

  <!-- é¥¼å›¾åŒºåŸŸ -->
  <view class="pie-chart-container">
    <canvas canvas-id="pieChart" class="pie-chart"></canvas>
  </view>

  <!-- å›¾ä¾‹å’Œæ•°æ®æ˜ç»† -->
  <view class="category-list">
    <view class="category-title">{{activeType === 'expense' ? 'æ”¯å‡º' : 'æ”¶å…¥'}}åˆ†ç±»æ˜ç»†</view>
    <block wx:if="{{activeType === 'expense'}}">
      <view class="category-item" wx:for="{{expenseCategoriesArray}}" wx:key="name">
        <view class="category-info">
          <view class="color-dot" style="background-color: {{item.color}}"></view>
          <text class="icon">{{item.icon}}</text>
          <text class="name">{{item.name}}</text>
        </view>
        <view class="category-data">
          <text class="percentage">{{item.percentage}}%</text>
          <text class="amount">Â¥{{item.value}}</text>
        </view>
      </view>
    </block>
    <block wx:else>
      <view class="category-item" wx:for="{{incomeCategoriesArray}}" wx:key="name">
        <view class="category-info">
          <view class="color-dot" style="background-color: {{item.color}}"></view>
          <text class="icon">{{item.icon}}</text>
          <text class="name">{{item.name}}</text>
        </view>
        <view class="category-data">
          <text class="percentage">{{item.percentage}}%</text>
          <text class="amount">Â¥{{item.value}}</text>
        </view>
      </view>
    </block>
  </view>

  <!-- æ— æ•°æ®æç¤º -->
  <view class="empty-state" wx:if="{{(activeType === 'expense' && expenseCategoriesArray.length === 0) || (activeType === 'income' && incomeCategoriesArray.length === 0)}}">
    <view class="empty-icon">ğŸ“Š</view>
    <text class="empty-text">æš‚æ— {{activeType === 'expense' ? 'æ”¯å‡º' : 'æ”¶å…¥'}}æ•°æ®</text>
    <text class="empty-subtext">æ·»åŠ ä¸€äº›è®°å½•æ¥æŸ¥çœ‹ç»Ÿè®¡æ•°æ®</text>
  </view>
</view> 